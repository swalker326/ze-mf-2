"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getBuildId = void 0;
const get_application_configuration_1 = require("./get-application-configuration");
const token_1 = require("../node-persist/token");
const ze_http_request_1 = require("../http/ze-http-request");
const errors_1 = require("../errors");
const logging_1 = require("../logging");
async function getBuildId(application_uid) {
    const { BUILD_ID_ENDPOINT, user_uuid, jwt, username } = await (0, get_application_configuration_1.getApplicationConfiguration)({
        application_uid,
    });
    const token = await (0, token_1.getToken)();
    const options = {
        headers: {
            can_write_jwt: jwt,
            Authorization: 'Bearer ' + token,
        },
    };
    const [ok, cause, data] = await ze_http_request_1.ZeHttpRequest.from(BUILD_ID_ENDPOINT, options);
    if (!ok || !data[user_uuid]) {
        throw new errors_1.ZephyrError(errors_1.ZeErrors.ERR_GET_BUILD_ID, {
            application_uid,
            username,
            cause,
            data,
        });
    }
    (0, logging_1.ze_log)('Build ID retrieved...', data);
    return data[user_uuid];
}
exports.getBuildId = getBuildId;
//# sourceMappingURL=get-build-id.js.map